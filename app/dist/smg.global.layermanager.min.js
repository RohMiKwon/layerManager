"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t,e){"undefined"==typeof t.smg&&(t.smg={}),"undefined"==typeof t.smg.global&&(t.smg.global={}),"undefined"==typeof t.smg.util&&(t.smg.util={});var i=t.smg["static"],s=(t.smg.util,t.smg.event),o=s.LAYER;t.smg.global.LayerManager=function(){function s(t){_classCallCheck(this,s),this.$layer=t.layer,this.$linked=t.linked,this.options=e.extend({},this.defaults(),t.options),this.onBeforeShowCallback=t.onBeforeShow,this.onShowCallback=t.onShow,this.onBeforeHideCallback=t.onBeforeHide,this.onHideCallback=t.onHide,this.init()}return s.prototype.defaults=function(){return this.dimmedClass="dimmed",this.keepdimmedClass="keep-dimmed",this.dimmedElement='<div class="'+this.dimmedClass+'"></div>',{enforceInitFocus:!0,bActivated:!0,keepDimmed:!1,closeButton:".close-button"}},s.prototype.activate=function(){this.show()},s.prototype.deactivate=function(){this.hide(),this.reset()},s.prototype.init=function(){this.assignedElements(),this.appendDimmed(),this.appendModuleClass(),this.bindEvents(),this.options.bActivated&&this.activate()},s.prototype.assignedElements=function(){this.$wrap=this.$layer.children(),this.$closeButton=this.$layer.find(this.options.closeButton)},s.prototype.appendModuleClass=function(){var t=i.CSS.LAYER_MODULE;this.$layer.hasClass(t)||this.$layer.addClass(t)},s.prototype.appendDimmed=function(){this.$layer.prepend(this.dimmedElement),this.$dimmed=this.$layer.find("."+this.dimmedClass)},s.prototype.unbindAllEvents=function(){e(t).off("resize",e.proxy(this.onResize,this)),this.$closeButton.off("click",e.proxy(this.onClickCloseButton,this)),this.$dimmed.off("click touchstart",e.proxy(this.onClickDimmed,this))},s.prototype.bindEvents=function(){e(t).off("resize",e.proxy(this.onResize,this)),e(t).on("resize",e.proxy(this.onResize,this)),this.$closeButton.off("click",e.proxy(this.onClickCloseButton,this)),this.$closeButton.on("click",e.proxy(this.onClickCloseButton,this)),this.options.keepDimmed?this.$dimmed.addClass(this.keepdimmedClass):(this.$dimmed.off("click touchstart",e.proxy(this.onClickCloseButton,this)),this.$dimmed.on("click touchstart",e.proxy(this.onClickCloseButton,this)))},s.prototype.onResize=function(){this.reposition()},s.prototype.onClickCloseButton=function(t){t.preventDefault(),this.hide(),this.reset()},s.prototype.reset=function(){this.unbindAllEvents(),this.$wrap.removeAttr("style"),this.$layer.removeClass(i.CSS.LAYER_MODULE),e("html").removeClass(i.CSS.LAYER_OPEN),this.$dimmed.removeClass(this.keepdimmedClass)},s.prototype.getLayer=function(){return this.$layer},s.prototype.getLinked=function(){return this.$linked?this.$linked:null},s.prototype.isVisible=function(){return"block"===this.$layer.css("display")},s.prototype.show=function(){"function"==typeof this.onBeforeShowCallback&&this.onBeforeShowCallback.apply(this,[this.getData(o.BEFORESHOW)]),this.$layer.trigger(this.getData(o.BEFORESHOW)),this.$layer.show(),this.showDimmed(),this.reposition(),this.options.enforceInitFocus&&this.enforceFocusLayer(),"function"==typeof this.onShowCallback&&this.onShowCallback.apply(this,[this.getData(o.SHOW)]),this.$layer.trigger(this.getData(o.SHOW))},s.prototype.hide=function(){"function"==typeof this.onBeforeHideCallback&&this.onBeforeHideCallback.apply(this,[this.getData(o.BEFOREHIDE)]),this.$layer.trigger(this.getData(o.BEFOREHIDE)),this.$layer.hide(),this.hideDimmed(),this.enforceFocusLinked(),"function"==typeof this.onHideCallback&&this.onHideCallback.apply(this,[this.getData(o.HIDE)]),this.$layer.trigger(this.getData(o.HIDE))},s.prototype.reposition=function(){var i=this.$wrap,s=e(t),o=parseInt(.5*(s.width()-i.outerWidth())),n=parseInt(.5*(s.height()-i.outerHeight()));n=0>=n?0:n,i.css({top:n,left:o}),this.setHeightDimmed(s.height(),i.outerHeight())},s.prototype.setHeightDimmed=function(t,e){var i=e>=t?e:t;this.$dimmed.css("height",i)},s.prototype.showDimmed=function(){this.$dimmed.show(),e("html").addClass(i.CSS.LAYER_OPEN)},s.prototype.hideDimmed=function(){this.$dimmed.remove(),e("html").removeClass(i.CSS.LAYER_OPEN)},s.prototype.enforceFocusLayer=function(){var t=this.$wrap,e=setTimeout(function(){t.attr("tabindex",-1).focus(),clearTimeout(e)},50)},s.prototype.enforceFocusLinked=function(){var t=this;if(this.$linked)var e=setTimeout(function(){t.$linked.focus(),clearTimeout(e)},50)},s.prototype.getData=function(t){return{type:t,manager:this,layer:this.$layer,linked:this.getLinked()}},s}(),e(document).on("click",'[data-module-id="layer"]',function(i){var s=e(this),o=e(s.data("layer-target"));s.is("a")&&i.preventDefault(),new t.smg.global.LayerManager({layer:o,linked:s})})}(window,jQuery);